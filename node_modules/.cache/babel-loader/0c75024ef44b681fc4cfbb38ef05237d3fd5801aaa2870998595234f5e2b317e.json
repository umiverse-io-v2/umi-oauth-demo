{"ast":null,"code":"var _jsxFileName = \"/Users/laifu/Documents/umiverse.io/repo_v2/umi-oauth-demo/src/Pages/LoginSuccess.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { decrypt } from '../utils/AES';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst secretKey = process.env.REACT_APP_API_SECRET || 'your-secret-key'; // Get the key from the environment variable\nconst apiHost = process.env.REACT_APP_API_HOST || 'umiverse-api-host';\nconst LoginSuccess = () => {\n  _s();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const queryParams = new URLSearchParams(location.search);\n  const authorizationCode = queryParams.get('authorizationCode');\n  const [idToken, setIdToken] = useState(null);\n  const [userInfo, setUserInfo] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Function to get user information\n  const fetchUserInfo = async token => {\n    try {\n      const response = await fetch(`${apiHost}/user/info`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          // 使用 Bearer Token\n          'Content-Type': 'application/json'\n        }\n      });\n      const result = await response.json();\n      if (response.ok) {\n        setUserInfo(result.data); // Saving User Data\n      } else {\n        setError(result.message || 'Failed to fetch user info');\n      }\n    } catch (err) {\n      setError('Error fetching user info');\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    if (authorizationCode) {\n      try {\n        // 解密 authorizationCode，得到 idToken\n        const decryptedData = decrypt(authorizationCode, secretKey);\n        setIdToken(decryptedData);\n\n        // 获取用户信息\n        fetchUserInfo(decryptedData);\n      } catch (error) {\n        console.error('Error decrypting authorizationCode:', error);\n        setError('Error decrypting authorizationCode');\n        setLoading(false);\n      }\n    }\n  }, [authorizationCode, navigate]);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 12\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Error: \", error]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: 'center',\n      marginTop: '50px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Login successful, welcome to our website!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), idToken && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Your idToken is: \", idToken]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 19\n    }, this), userInfo ? /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"User Info\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"ID:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 14\n        }, this), \" \", userInfo.id]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Create Time:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 14\n        }, this), \" \", userInfo.create_time]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Email:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 14\n        }, this), \" \", userInfo.email]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Picture:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 14\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"img\", {\n          style: {\n            width: '30px'\n          },\n          src: userInfo.picture,\n          alt: \"User Avatar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 40\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"User Name:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 14\n        }, this), \" \", userInfo.user_name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Wallet Address:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 14\n        }, this), \" \", userInfo.wallet_address]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Login Method:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 14\n        }, this), \" \", userInfo.loginMethod]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"No user data available\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n};\n_s(LoginSuccess, \"73plGWUSvijV4xHnCAugHWCszkA=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = LoginSuccess;\nexport default LoginSuccess;\nvar _c;\n$RefreshReg$(_c, \"LoginSuccess\");","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useLocation","decrypt","jsxDEV","_jsxDEV","secretKey","process","env","REACT_APP_API_SECRET","apiHost","REACT_APP_API_HOST","LoginSuccess","_s","navigate","location","queryParams","URLSearchParams","search","authorizationCode","get","idToken","setIdToken","userInfo","setUserInfo","loading","setLoading","error","setError","fetchUserInfo","token","response","fetch","method","headers","result","json","ok","data","message","err","decryptedData","console","children","fileName","_jsxFileName","lineNumber","columnNumber","style","textAlign","marginTop","id","create_time","email","width","src","picture","alt","user_name","wallet_address","loginMethod","_c","$RefreshReg$"],"sources":["/Users/laifu/Documents/umiverse.io/repo_v2/umi-oauth-demo/src/Pages/LoginSuccess.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { decrypt } from '../utils/AES';\n\nconst secretKey = process.env.REACT_APP_API_SECRET || 'your-secret-key'; // Get the key from the environment variable\nconst apiHost = process.env.REACT_APP_API_HOST || 'umiverse-api-host';\ninterface UserInfo {\n  id: number;\n  create_time: string;\n  email: string;\n  picture: string;\n  user_name: string;\n  wallet_address: string;\n  loginMethod: string;\n}\n\nconst LoginSuccess: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const queryParams = new URLSearchParams(location.search);\n  const authorizationCode = queryParams.get('authorizationCode');\n  const [idToken, setIdToken] = useState<string | null>(null);\n  const [userInfo, setUserInfo] = useState<UserInfo | null>(null);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Function to get user information\n  const fetchUserInfo = async (token: string) => {\n    try {\n      const response = await fetch(`${apiHost}/user/info`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`, // 使用 Bearer Token\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const result = await response.json();\n      if (response.ok) {\n        setUserInfo(result.data); // Saving User Data\n      } else {\n        setError(result.message || 'Failed to fetch user info');\n      }\n    } catch (err) {\n      setError('Error fetching user info');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (authorizationCode) {\n      try {\n        // 解密 authorizationCode，得到 idToken\n        const decryptedData = decrypt(authorizationCode, secretKey);\n        setIdToken(decryptedData);\n\n        // 获取用户信息\n        fetchUserInfo(decryptedData);\n\n      } catch (error) {\n        console.error('Error decrypting authorizationCode:', error);\n        setError('Error decrypting authorizationCode');\n        setLoading(false);\n      }\n    }\n  }, [authorizationCode, navigate]);\n\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n\n  if (error) {\n    return <div>Error: {error}</div>;\n  }\n\n  return (\n    <div style={{ textAlign: 'center', marginTop: '50px' }}>\n      <h1>Login successful, welcome to our website!</h1>\n      {idToken && <p>Your idToken is: {idToken}</p>}\n\n      {userInfo ? (\n        <div>\n          <h2>User Info</h2>\n          <p><strong>ID:</strong> {userInfo.id}</p>\n          <p><strong>Create Time:</strong> {userInfo.create_time}</p>\n          <p><strong>Email:</strong> {userInfo.email}</p>\n          <p><strong>Picture:</strong> <img style={{width:'30px'}} src={userInfo.picture} alt=\"User Avatar\" /></p>\n          <p><strong>User Name:</strong> {userInfo.user_name}</p>\n          <p><strong>Wallet Address:</strong> {userInfo.wallet_address}</p>\n          <p><strong>Login Method:</strong> {userInfo.loginMethod}</p>\n        </div>\n      ) : (\n        <p>No user data available</p>\n      )}\n    </div>\n  );\n};\n\nexport default LoginSuccess;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}